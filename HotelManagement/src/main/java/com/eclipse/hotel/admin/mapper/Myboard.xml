<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
     "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
     
        
<mapper namespace="com.eclipse.hotel.admin.mapper.Myboard">

<sql id="search">
<where>
b.m_num=m.m_num 
<if test="word!=null and field=='title'"> and b.title like '%${word}%' </if>
<if test="word!=null and field=='id'"> and id like '%${word}%' </if> 
</where> 
</sql>
 
	<!-- 추가 -->
	<insert id="managementboardinsert" parameterType="boardVO">
	insert into board 
	values(1,#{category},#{title},#{password},#{content},0,sysdate,board_seq.nextval,0,0,board_seq.nextval)
	</insert>
	
	<!-- 26~37전체보기 -->
	<!-- 전체보기 검색 -->
	<select id="managementboardlist" parameterType="map" resultType="boardVO">
	select * from (select rownum rnum, aa.* 
	from (select b.m_num,b.category,b.title,b.password,b.content,b.count,b.registerdate,b.groups,b.levels,b.steps,b.b_num,m.id,m.name 
		from board b,member m <include refid="search"/> and category=#{category}
		order by b.groups desc,b.levels, b.steps desc) aa) 
	where rnum &gt;=${startRow} and rnum&lt;=${endRow}
	</select> 

	<!-- 검색 카운트 -->
	<select id="countSearchData" parameterType="map" resultType="int">
	select count(*) from board b,member m 
	<include refid="search"/> and category=#{category}
	</select>	
	
	<!-- 상세보기 --> 
	<select id="managementboarddetail" resultType="boardVO"> 
	select b.m_num,b.category,b.title,b.password,b.content,b.count,b.registerdate,b.groups,b.levels,b.steps,b.b_num,m.id,m.name from board b,member m where b_num=#{b_num} and b.m_num=m.m_num
	</select>
	
	<!-- 수정하기 -->
	<update id="managementboardupdate" parameterType="boardVO">
	update board set title=#{title},content=#{content} where b_num=#{b_num}
	</update>
	
	<!-- 삭제하기
	<delete id="managementboarddelete" parameterType="String">
	delete from board where b_num=#{b_num}
	</delete>
	!-->
	<!-- 삭제하기 -->
	<delete id="managementboarddelete" parameterType="String">
	delete board where groups=#{groups} and (levels>=#{levels} and steps>=#{steps}) and b_num>=#{b_num}
	</delete>
	<!-- ses -->
	<select id="CheckData" parameterType="int" resultType="String">
	select password from board where b_num=#{b_num}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="CountData" parameterType="int">
	update board set count=count+1 where b_num=#{b_num}
	</update>
	
	<!-- 댓글 -->
	
	<!-- 전체보기 검색 --> 
	<select id="listData" resultType="boardVO" parameterType="int">
	select * from comment_board where b_num=#{b_num} order by c_num
	</select>
	
	<!-- 추가 -->
	<insert id="cinsertData" parameterType="boardVO">
	insert into comment_board values(comment_board_seq.nextval,#{b_num},#{memo},sysdate)
	</insert>
	
	<!-- 댓글 삭제 -->
	<delete id="myDelete" parameterType="int">
	delete from comment_board where c_num=#{c_num}
	</delete>
	
	<!-- 답글 -->
	
	<!-- 상세보기 -->
	<select id="DetailData" resultType="boardVO"> 
	select * from board where b_num=#{b_num}
	</select>
	
		
	<!-- reply 수정 -->
	<update id="replyData" parameterType="boardVO">
	update board set levels=levels+1 where groups=#{groups} and levels>#{levels}
	</update>
	 
	<!-- reply 추가 -->
	<insert id="replyData1" parameterType="boardVO">
	insert into board(m_num,b_num,title,category,password,content,registerdate,groups,count,levels,steps) values(1,board_seq.nextval,#{title},#{category},#{password},#{content},sysdate,#{groups},0,#{levels}+1,#{steps}+1)
	</insert>
</mapper>